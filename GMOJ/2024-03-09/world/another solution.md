首先，$A\gets A\oplus B$，我们的问题就变成了怎么操作使得一个空矩阵变成新的矩阵 $A$。

---

先考虑只能操作行和列，该怎么做。

如果这张图是合法的，我们发现对于任意的 $2\times2$ **子矩阵** $\begin{bmatrix}
a_{0,0} & a_{0,1} \\
a_{1,0} &  a_{1,1}
\end{bmatrix}$，有 $a_{0,0}\oplus a_{0,1}\oplus a_{1,0}\oplus a_{1,1}=0$。

我们来证明一下，因为对于操作行和列，一定会操作 $2\times2$ 子矩阵中的任意两个，那么异或结果不变。

所以，我们定义 $a_{0,0},a_{0,1},a_{1,0},a_{1,1}$ 这类异或结果不变的为**固定元素**，其余的为不固定元素。

$2\times2$ 子矩阵中有固定元素，也就是这个子矩阵被固定了，所以它合法。

---

存不存在更小的子矩阵呢？比如说 $1\times1$ 子矩阵。

答案是不存在的，因为对于一个 $1\times1$ 子矩阵 $\begin{bmatrix}
a_{0,0}
\end{bmatrix}$，我们可以随意修改这个点，所以不存在固定元素，不合法。

---

考虑加入对角线操作。

如果还是刚刚的 $2\times2$ 矩阵，我们发现由于对角线操作的加入可以出现形如 $\begin{bmatrix}
0 & 1 \\
1 &  1
\end{bmatrix}$，$\begin{bmatrix}
0 & 0 \\
0 &  1
\end{bmatrix}$ 等等等等的矩阵，子矩阵中**没有一个元素是固定元素**，这个子矩阵是不固定的！

所以考虑更大的子矩阵。

---

考虑一个 $4\times4$ 子矩阵，我们发现对于任意的 $4\times4$ 子矩阵 $\begin{bmatrix}
a_{0,0} & \textcolor{red}{a_{0,1}} & \textcolor{red}{a_{0,2}} & a_{0,3} \\
\textcolor{red}{a_{1,0}} & a_{1,1} & a_{1,2} & \textcolor{red}{a_{1,3}} \\
\textcolor{red}{a_{2,0}} & a_{2,1} & a_{2,2} & \textcolor{red}{a_{2,3}} \\
a_{3,0} & \textcolor{red}{a_{3,1}} & \textcolor{red}{a_{3,2}} & a_{3,3} \\
\end{bmatrix}$，有 $a_{0,1}\oplus a_{0,2}\oplus a_{1,0}\oplus a_{1,3}\oplus a_{2,0}\oplus a_{2,3}\oplus a_{3,1}\oplus a_{3,2}=0$。（为了方便我将这些固定元素标红）

证明显然：

- 对于 $a_{0,0},a_{0,3},a_{3,0},a_{3,3}$，可以进行一个对角线操作，所以这些元素是可以随便调整的，是不固定元素；
- 对于 $a_{0,1},a_{0,2},a_{1,0},a_{1,3},a_{2,0},a_{2,3},a_{3,1},a_{3,2}$，这些元素无法抵消，只能进行对角线同时操作两个**固定元素**，所以异或结果不会变化；
- 对于 $a_{1,1},a_{1,2},a_{2,2},a_{2,2}$，这些元素可以通过乱搞抵消，具体自己乱搞。

所以这个子矩阵是固定的。

我们继续发现，不存在比 $4\times4$ 还小的子矩阵。

---

所以这道题就很简单了，枚举**矩阵** $A$ 的子矩阵左上角 $(i,j)$，只需要所有的子矩阵均满足满足 $a_{i,j+1}\oplus a_{i,j+2}\oplus a_{i+1,j}\oplus a_{i+1,j+3}\oplus a_{i+2,j}\oplus a_{i+2,j+3}\oplus a_{i+3,1}\oplus a_{j+3,2}=0$，则这张图有解。

时间复杂度 $O(nm)$。

---

然后这道题就可以开始加强了，比如加入各种新印章，都可以用这种方法轻松解决。