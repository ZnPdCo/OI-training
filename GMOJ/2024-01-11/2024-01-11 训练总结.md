# [2024-01-11 è®­ç»ƒæ€»ç»“](https://www.cnblogs.com/znpdco/p/17959509)

## T1 æ„¤æ€’çš„å°é¸Ÿ

> # [NOIP2016 æé«˜ç»„] æ„¤æ€’çš„å°é¸Ÿ
>
> ## é¢˜ç›®èƒŒæ™¯
>
> NOIP2016 æé«˜ç»„ D2T3
>
> ## é¢˜ç›®æè¿°
>
> Kiana æœ€è¿‘æ²‰è¿·äºä¸€æ¬¾ç¥å¥‡çš„æ¸¸æˆæ— æ³•è‡ªæ‹”ã€‚
>
> ç®€å•æ¥è¯´ï¼Œè¿™æ¬¾æ¸¸æˆæ˜¯åœ¨ä¸€ä¸ªå¹³é¢ä¸Šè¿›è¡Œçš„ã€‚
>
> æœ‰ä¸€æ¶å¼¹å¼“ä½äº $(0,0)$ å¤„ï¼Œæ¯æ¬¡ Kiana å¯ä»¥ç”¨å®ƒå‘ç¬¬ä¸€è±¡é™å‘å°„ä¸€åªçº¢è‰²çš„å°é¸Ÿï¼Œå°é¸Ÿä»¬çš„é£è¡Œè½¨è¿¹å‡ä¸ºå½¢å¦‚ $y=ax^2+bx$ çš„æ›²çº¿ï¼Œå…¶ä¸­ $a,b$ æ˜¯ Kiana æŒ‡å®šçš„å‚æ•°ï¼Œä¸”å¿…é¡»æ»¡è¶³ $a < 0$ï¼Œ$a,b$ éƒ½æ˜¯å®æ•°ã€‚
>
> å½“å°é¸Ÿè½å›åœ°é¢ï¼ˆå³ $x$ è½´ï¼‰æ—¶ï¼Œå®ƒå°±ä¼šç¬é—´æ¶ˆå¤±ã€‚
>
> åœ¨æ¸¸æˆçš„æŸä¸ªå…³å¡é‡Œï¼Œå¹³é¢çš„ç¬¬ä¸€è±¡é™ä¸­æœ‰ $n$ åªç»¿è‰²çš„å°çŒªï¼Œå…¶ä¸­ç¬¬ $i$ åªå°çŒªæ‰€åœ¨çš„åæ ‡ä¸º $\left(x_i,y_i \right)$ã€‚
>
> å¦‚æœæŸåªå°é¸Ÿçš„é£è¡Œè½¨è¿¹ç»è¿‡äº† $\left( x_i, y_i \right)$ï¼Œé‚£ä¹ˆç¬¬ $i$ åªå°çŒªå°±ä¼šè¢«æ¶ˆç­æ‰ï¼ŒåŒæ—¶å°é¸Ÿå°†ä¼šæ²¿ç€åŸå…ˆçš„è½¨è¿¹ç»§ç»­é£è¡Œï¼›
>
> å¦‚æœä¸€åªå°é¸Ÿçš„é£è¡Œè½¨è¿¹æ²¡æœ‰ç»è¿‡ $\left( x_i, y_i \right)$ï¼Œé‚£ä¹ˆè¿™åªå°é¸Ÿé£è¡Œçš„å…¨è¿‡ç¨‹å°±ä¸ä¼šå¯¹ç¬¬ $i$ åªå°çŒªäº§ç”Ÿä»»ä½•å½±å“ã€‚
>
> ä¾‹å¦‚ï¼Œè‹¥ä¸¤åªå°çŒªåˆ†åˆ«ä½äº $(1,3)$ å’Œ $(3,3)$ï¼ŒKiana å¯ä»¥é€‰æ‹©å‘å°„ä¸€åªé£è¡Œè½¨è¿¹ä¸º $y=-x^2+4x$ çš„å°é¸Ÿï¼Œè¿™æ ·ä¸¤åªå°çŒªå°±ä¼šè¢«è¿™åªå°é¸Ÿä¸€èµ·æ¶ˆç­ã€‚
>
> è€Œè¿™ä¸ªæ¸¸æˆçš„ç›®çš„ï¼Œå°±æ˜¯é€šè¿‡å‘å°„å°é¸Ÿæ¶ˆç­æ‰€æœ‰çš„å°çŒªã€‚
>
> è¿™æ¬¾ç¥å¥‡æ¸¸æˆçš„æ¯ä¸ªå…³å¡å¯¹ Kiana æ¥è¯´éƒ½å¾ˆéš¾ï¼Œæ‰€ä»¥ Kiana è¿˜è¾“å…¥äº†ä¸€äº›ç¥ç§˜çš„æŒ‡ä»¤ï¼Œä½¿å¾—è‡ªå·±èƒ½æ›´è½»æ¾åœ°å®Œæˆè¿™ä¸ªæ¸¸æˆã€‚è¿™äº›æŒ‡ä»¤å°†åœ¨ã€è¾“å…¥æ ¼å¼ã€‘ä¸­è¯¦è¿°ã€‚
>
> å‡è®¾è¿™æ¬¾æ¸¸æˆä¸€å…±æœ‰ $T$ ä¸ªå…³å¡ï¼Œç°åœ¨ Kiana æƒ³çŸ¥é“ï¼Œå¯¹äºæ¯ä¸€ä¸ªå…³å¡ï¼Œè‡³å°‘éœ€è¦å‘å°„å¤šå°‘åªå°é¸Ÿæ‰èƒ½æ¶ˆç­æ‰€æœ‰çš„å°çŒªã€‚ç”±äºå¥¹ä¸ä¼šç®—ï¼Œæ‰€ä»¥å¸Œæœ›ç”±ä½ å‘Šè¯‰å¥¹ã€‚
>
> ## è¾“å…¥æ ¼å¼
>
> ç¬¬ä¸€è¡ŒåŒ…å«ä¸€ä¸ªæ­£æ•´æ•° $T$ï¼Œè¡¨ç¤ºæ¸¸æˆçš„å…³å¡æ€»æ•°ã€‚
>
> ä¸‹é¢ä¾æ¬¡è¾“å…¥è¿™ $T$ ä¸ªå…³å¡çš„ä¿¡æ¯ã€‚æ¯ä¸ªå…³å¡ç¬¬ä¸€è¡ŒåŒ…å«ä¸¤ä¸ªéè´Ÿæ•´æ•° $n,m$ï¼Œåˆ†åˆ«è¡¨ç¤ºè¯¥å…³å¡ä¸­çš„å°çŒªæ•°é‡å’Œ Kiana è¾“å…¥çš„ç¥ç§˜æŒ‡ä»¤ç±»å‹ã€‚æ¥ä¸‹æ¥çš„ $n$ è¡Œä¸­ï¼Œç¬¬ $i$ è¡ŒåŒ…å«ä¸¤ä¸ªæ­£å®æ•° $x_i,y_i$ï¼Œè¡¨ç¤ºç¬¬ $i$ åªå°çŒªåæ ‡ä¸º $(x_i,y_i)$ã€‚æ•°æ®ä¿è¯åŒä¸€ä¸ªå…³å¡ä¸­ä¸å­˜åœ¨ä¸¤åªåæ ‡å®Œå…¨ç›¸åŒçš„å°çŒªã€‚
>
> å¦‚æœ $m=0$ï¼Œè¡¨ç¤º Kiana è¾“å…¥äº†ä¸€ä¸ªæ²¡æœ‰ä»»ä½•ä½œç”¨çš„æŒ‡ä»¤ã€‚
>
> å¦‚æœ $m=1$ï¼Œåˆ™è¿™ä¸ªå…³å¡å°†ä¼šæ»¡è¶³ï¼šè‡³å¤šç”¨ $\lceil n/3 + 1 \rceil$ åªå°é¸Ÿå³å¯æ¶ˆç­æ‰€æœ‰å°çŒªã€‚
>
> å¦‚æœ $m=2$ï¼Œåˆ™è¿™ä¸ªå…³å¡å°†ä¼šæ»¡è¶³ï¼šä¸€å®šå­˜åœ¨ä¸€ç§æœ€ä¼˜è§£ï¼Œå…¶ä¸­æœ‰ä¸€åªå°é¸Ÿæ¶ˆç­äº†è‡³å°‘ $\lfloor n/3 \rfloor$ åªå°çŒªã€‚
>
> ä¿è¯ $1\leq n \leq 18$ï¼Œ$0\leq m \leq 2$ï¼Œ$0 < x_i,y_i < 10$ï¼Œè¾“å…¥ä¸­çš„å®æ•°å‡ä¿ç•™åˆ°å°æ•°ç‚¹åä¸¤ä½ã€‚
>
> ä¸Šæ–‡ä¸­ï¼Œç¬¦å· $\lceil c \rceil$ å’Œ $\lfloor c \rfloor$ åˆ†åˆ«è¡¨ç¤ºå¯¹ $c$ å‘ä¸Šå–æ•´å’Œå‘ä¸‹å–æ•´ï¼Œä¾‹å¦‚ï¼š$\lceil 2.1 \rceil = \lceil 2.9 \rceil = \lceil 3.0 \rceil = \lfloor 3.0 \rfloor = \lfloor 3.1 \rfloor = \lfloor 3.9 \rfloor = 3$ã€‚
>
> ## è¾“å‡ºæ ¼å¼
>
> å¯¹æ¯ä¸ªå…³å¡ä¾æ¬¡è¾“å‡ºä¸€è¡Œç­”æ¡ˆã€‚
>
> è¾“å‡ºçš„æ¯ä¸€è¡ŒåŒ…å«ä¸€ä¸ªæ­£æ•´æ•°ï¼Œè¡¨ç¤ºç›¸åº”çš„å…³å¡ä¸­ï¼Œæ¶ˆç­æ‰€æœ‰å°çŒªæœ€å°‘éœ€è¦çš„å°é¸Ÿæ•°é‡ã€‚
>
> ## æ ·ä¾‹ #1
>
> ### æ ·ä¾‹è¾“å…¥ #1
>
> ```
> 2
> 2 0
> 1.00 3.00
> 3.00 3.00
> 5 2
> 1.00 5.00
> 2.00 8.00
> 3.00 9.00
> 4.00 8.00
> 5.00 5.00
> ```
>
> ### æ ·ä¾‹è¾“å‡º #1
>
> ```
> 1
> 1
> ```
>
> ## æ ·ä¾‹ #2
>
> ### æ ·ä¾‹è¾“å…¥ #2
>
> ```
> 3
> 2 0
> 1.41 2.00
> 1.73 3.00
> 3 0
> 1.11 1.41
> 2.34 1.79
> 2.98 1.49
> 5 0
> 2.72 2.72
> 2.72 3.14
> 3.14 2.72
> 3.14 3.14
> 5.00 5.00
> ```
>
> ### æ ·ä¾‹è¾“å‡º #2
>
> ```
> 2
> 2
> 3
> ```
>
> ## æ ·ä¾‹ #3
>
> ### æ ·ä¾‹è¾“å…¥ #3
>
> ```
> 1
> 10 0
> 7.16 6.28
> 2.02 0.38
> 8.33 7.78
> 7.68 2.09
> 7.46 7.86
> 5.77 7.44
> 8.24 6.72
> 4.42 5.11
> 5.42 7.79
> 8.15 4.99
> ```
>
> ### æ ·ä¾‹è¾“å‡º #3
>
> ```
> 6
> ```
>
> ## æç¤º
>
> ã€æ ·ä¾‹è§£é‡Š1ã€‘
>
> è¿™ç»„æ•°æ®ä¸­ä¸€å…±æœ‰ä¸¤ä¸ªå…³å¡ã€‚
>
> ç¬¬ä¸€ä¸ªå…³å¡ä¸ã€é—®é¢˜æè¿°ã€‘ä¸­çš„æƒ…å½¢ç›¸åŒï¼Œ$2$ åªå°çŒªåˆ†åˆ«ä½äº $(1.00,3.00)$ å’Œ $(3.00,3.00)$ï¼Œåªéœ€å‘å°„ä¸€åªé£è¡Œè½¨è¿¹ä¸º $y = -x^2 + 4x$ çš„å°é¸Ÿå³å¯æ¶ˆç­å®ƒä»¬ã€‚
>
> ç¬¬äºŒä¸ªå…³å¡ä¸­æœ‰ $5$ åªå°çŒªï¼Œä½†ç»è¿‡è§‚å¯Ÿæˆ‘ä»¬å¯ä»¥å‘ç°å®ƒä»¬çš„åæ ‡éƒ½åœ¨æŠ›ç‰©çº¿ $y = -x^2 + 6x$ä¸Šï¼Œæ•… Kiana åªéœ€è¦å‘å°„ä¸€åªå°é¸Ÿå³å¯æ¶ˆç­æ‰€æœ‰å°çŒªã€‚
>
> ã€æ•°æ®èŒƒå›´ã€‘
>
> | æµ‹è¯•ç‚¹ç¼–å· | $n\leqslant$ | $m=$ | $T\leqslant$ |
> | :--------: | :----------: | :--: | :----------: |
> |    $1$     |     $2$      | $0$  |     $10$     |
> |    $2$     |     $2$      | $0$  |     $30$     |
> |    $3$     |     $3$      | $0$  |     $10$     |
> |    $4$     |     $3$      | $0$  |     $30$     |
> |    $5$     |     $4$      | $0$  |     $10$     |
> |    $6$     |     $4$      | $0$  |     $30$     |
> |    $7$     |     $5$      | $0$  |     $10$     |
> |    $8$     |     $6$      | $0$  |     $10$     |
> |    $9$     |     $7$      | $0$  |     $10$     |
> |    $10$    |     $8$      | $0$  |     $10$     |
> |    $11$    |     $9$      | $0$  |     $30$     |
> |    $12$    |     $10$     | $0$  |     $30$     |
> |    $13$    |     $12$     | $1$  |     $30$     |
> |    $14$    |     $12$     | $2$  |     $30$     |
> |    $15$    |     $15$     | $0$  |     $15$     |
> |    $16$    |     $15$     | $1$  |     $15$     |
> |    $17$    |     $15$     | $2$  |     $15$     |
> |    $18$    |     $18$     | $0$  |     $5$      |
> |    $19$    |     $18$     | $1$  |     $5$      |
> |    $20$    |     $18$     | $2$  |     $5$      |

åˆšåˆšæˆ‘å†™æ€»ç»“æ—¶çªç„¶å‘ç°ï¼Œæˆ‘èµ›æ—¶çš„åšæ³•æ—¶é—´å¤æ‚åº¦å°±æ˜¯æ­£ç¡®çš„ï¼Œåªæ˜¯æˆ‘ç®—é”™äº†è€Œå·²ğŸ¤£ã€‚

é¢˜ç›®å®¹æ˜“è®©äººæƒ³åˆ°çŠ¶å‹ï¼Œç„¶åè®¾è®¡ $f_s$ ä¸ºå‡»æ€çŠ¶æ€ä¸º $s$ æ‰€éœ€çš„æ•°é‡ï¼Œç„¶åå¯ä»¥æå‰ $O(n^3)$ é¢„å¤„ç†æ¯ä¸€æ¡æŠ›ç‰©çº¿ï¼Œå…·ä½“çš„ï¼Œæšä¸¾ä»»æ„ä¸¤ä¸ªç‚¹ç„¶åæ¨å¼å­è®¡ç®— $a,b$ï¼Œå†æŠŠ $n$ ä¸ªç‚¹è·‘ä¸€éçœ‹æœ‰å¤šå°‘ä¸ªçŒªå¯ä»¥é¡ºå¸¦æ‰“åˆ°å°±å¯ä»¥äº†ã€‚

åé¢æœ‰æ–¹ç¨‹ $f_{s|\text{line}}\gets\min(f_{s|\text{line}},f_s+1)$ã€‚

å¯èƒ½æ˜¯å› ä¸ºèµ›æ—¶ç´§å¼ è¿˜æ˜¯ä»€ä¹ˆçš„ï¼Œæ—¶é—´å¤æ‚åº¦è¢«æˆ‘ç®—æˆäº† $O(n^52^n)$ï¼Œå®é™…ä¸Šæ˜¯ $O(n^22^n)$ï¼Œè¿™ç§ç²—å¿ƒå¸Œæœ›ä¸‹æ¬¡ä¸è¦å†çŠ¯äº†ã€‚

```c++
/**
 * @file æ„¤æ€’çš„å°é¸Ÿ.cpp 
 * @tag: #GMOJ#dp#çŠ¶å‹dp#æ•°å­¦
 * @author: ZnPdCo
 * @date: 2024-01-11 20:57:17
 * @problem: https://gmoj.net/senior/#main/show/4908
 **/
#include <cstdio>
#include <cmath>
#include <algorithm>
#define ll long long
using namespace std;
#define N 20
ll T, n, m;
double x[N], y[N];
ll line[10*N], cnt;
ll f[1<<N];
int main() {
	freopen("angrybirds.in", "r", stdin);
	freopen("angrybirds.out", "w", stdout);
	scanf("%lld", &T);
	while(T--) {
		scanf("%lld %lld", &n, &m);
		for(ll i = 1; i <= n; i++) {
			scanf("%lf %lf", &x[i], &y[i]);
		}
		cnt = 0;
		for(ll i = 1; i <= n; i++) {
			for(ll j = i+1; j <= n; j++) if(x[i] != x[j] || y[i] != y[j]) {
/*
ä¸‹é¢è¿™ä¸ªå…¬å¼æˆ‘æ•°å­¦ä¸å¥½ï¼ŒæŠŠæ¨å¯¼æ”¾åœ¨è¿™æ–¹ä¾¿ä»¥åæ¥çœ‹
$$
\because\begin{cases}
y_i=ax_i^2+bx_i \\
y_j=ax_j^2+bx_j
\end{cases} \\
\therefore\begin{cases}
\frac{y_i}{x_i}=ax_i+b \\
\frac{y_j}{x_j}=ax_j+b
\end{cases} \\
\therefore a(x_i-x_j)=\frac{y_i}{x_i}-\frac{y_j}{x_j} \\
\therefore a=(\frac{y_i}{x_i}-\frac{y_j}{x_j})\div(x_i-x_j) \\
\therefore b=\frac{y_i}{x_i}-ax_i
$$
*/
				double a = (y[i]/x[i]-y[j]/x[j])/(x[i]-x[j]);
				double b = y[i]/x[i]-a*x[i];
				if(a >= 0) continue;
				line[++cnt] = 0;
				for(ll k = 1; k <= n; k++) {
					if(abs(a*x[k]*x[k]+b*x[k]-y[k]) <= 1e-9) {
						line[cnt] |= (1<<(k-1));
					}
				}
			}
			
			
			line[++cnt] = 0;
			for(ll j = i+1; j <= n; j++) if(x[i] == x[j] && y[i] == y[j]) {
				line[cnt] |= (1<<(j-1));
			}
		}
		for(ll s = 1; s < (1<<n); s++) f[s] = 1e15;
		for(ll s = 0; s < (1<<n); s++) {
			for(ll i = 1; i <= cnt; i++) {
				f[s|line[i]] = min(f[s|line[i]], f[s] + 1);
			}
			for(ll i = 1; i <= n; i++) {
				f[s|(1<<(i-1))] = min(f[s|(1<<(i-1))], f[s] + 1);
			}
		}
		printf("%lld\n", f[(1<<n)-1]);
	}
}
```

## T2 æ¢æ•™å®¤

> # [NOIP2016 æé«˜ç»„] æ¢æ•™å®¤
>
> ## é¢˜ç›®èƒŒæ™¯
>
> NOIP2016 æé«˜ç»„ D1T3
>
> ## é¢˜ç›®æè¿°
>
> å¯¹äºåˆšä¸Šå¤§å­¦çš„ç‰›ç‰›æ¥è¯´ï¼Œä»–é¢ä¸´çš„ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯å¦‚ä½•æ ¹æ®å®é™…æƒ…å†µç”³è¯·åˆé€‚çš„è¯¾ç¨‹ã€‚
>
>
> åœ¨å¯ä»¥é€‰æ‹©çš„è¯¾ç¨‹ä¸­ï¼Œæœ‰ $2n$ èŠ‚è¯¾ç¨‹å®‰æ’åœ¨ $n$ ä¸ªæ—¶é—´æ®µä¸Šã€‚åœ¨ç¬¬ $i$ï¼ˆ$1 \leq i \leq n$ï¼‰ä¸ªæ—¶é—´æ®µä¸Šï¼Œä¸¤èŠ‚å†…å®¹ç›¸åŒçš„è¯¾ç¨‹åŒæ—¶åœ¨ä¸åŒçš„åœ°ç‚¹è¿›è¡Œï¼Œå…¶ä¸­ï¼Œç‰›ç‰›é¢„å…ˆè¢«å®‰æ’åœ¨æ•™å®¤ $c_i$ ä¸Šè¯¾ï¼Œè€Œå¦ä¸€èŠ‚è¯¾ç¨‹åœ¨æ•™å®¤ $d_i$ è¿›è¡Œã€‚
>
>
> åœ¨ä¸æäº¤ä»»ä½•ç”³è¯·çš„æƒ…å†µä¸‹ï¼Œå­¦ç”Ÿä»¬éœ€è¦æŒ‰æ—¶é—´æ®µçš„é¡ºåºä¾æ¬¡å®Œæˆæ‰€æœ‰çš„ $n$ èŠ‚å®‰æ’å¥½çš„è¯¾ç¨‹ã€‚å¦‚æœå­¦ç”Ÿæƒ³æ›´æ¢ç¬¬ $i$ èŠ‚è¯¾ç¨‹çš„æ•™å®¤ï¼Œåˆ™éœ€è¦æå‡ºç”³è¯·ã€‚è‹¥ç”³è¯·é€šè¿‡ï¼Œå­¦ç”Ÿå°±å¯ä»¥åœ¨ç¬¬ $i$ ä¸ªæ—¶é—´æ®µå»æ•™å®¤ $d_i$ ä¸Šè¯¾ï¼Œå¦åˆ™ä»ç„¶åœ¨æ•™å®¤ $c_i$ ä¸Šè¯¾ã€‚
>
>
> ç”±äºæ›´æ¢æ•™å®¤çš„éœ€æ±‚å¤ªå¤šï¼Œç”³è¯·ä¸ä¸€å®šèƒ½è·å¾—é€šè¿‡ã€‚é€šè¿‡è®¡ç®—ï¼Œç‰›ç‰›å‘ç°ç”³è¯·æ›´æ¢ç¬¬ $i$ èŠ‚è¯¾ç¨‹çš„æ•™å®¤æ—¶ï¼Œç”³è¯·è¢«é€šè¿‡çš„æ¦‚ç‡æ˜¯ä¸€ä¸ªå·²çŸ¥çš„å®æ•° $k_i$ï¼Œå¹¶ä¸”å¯¹äºä¸åŒè¯¾ç¨‹çš„ç”³è¯·ï¼Œè¢«é€šè¿‡çš„æ¦‚ç‡æ˜¯äº’ç›¸ç‹¬ç«‹çš„ã€‚
>
>
> å­¦æ ¡è§„å®šï¼Œæ‰€æœ‰çš„ç”³è¯·åªèƒ½åœ¨å­¦æœŸå¼€å§‹å‰ä¸€æ¬¡æ€§æäº¤ï¼Œå¹¶ä¸”æ¯ä¸ªäººåªèƒ½é€‰æ‹©è‡³å¤š $m$ èŠ‚è¯¾ç¨‹è¿›è¡Œç”³è¯·ã€‚è¿™æ„å‘³ç€ç‰›ç‰›å¿…é¡»ä¸€æ¬¡æ€§å†³å®šæ˜¯å¦ç”³è¯·æ›´æ¢æ¯èŠ‚è¯¾çš„æ•™å®¤ï¼Œè€Œä¸èƒ½æ ¹æ®æŸäº›è¯¾ç¨‹çš„ç”³è¯·ç»“æœæ¥å†³å®šå…¶ä»–è¯¾ç¨‹æ˜¯å¦ç”³è¯·ï¼›ç‰›ç‰›å¯ä»¥ç”³è¯·è‡ªå·±æœ€å¸Œæœ›æ›´æ¢æ•™å®¤çš„ $m$ é—¨è¯¾ç¨‹ï¼Œä¹Ÿå¯ä»¥ä¸ç”¨å®Œè¿™ $m$ ä¸ªç”³è¯·çš„æœºä¼šï¼Œç”šè‡³å¯ä»¥ä¸€é—¨è¯¾ç¨‹éƒ½ä¸ç”³è¯·ã€‚
>
>
> å› ä¸ºä¸åŒçš„è¯¾ç¨‹å¯èƒ½ä¼šè¢«å®‰æ’åœ¨ä¸åŒçš„æ•™å®¤è¿›è¡Œï¼Œæ‰€ä»¥ç‰›ç‰›éœ€è¦åˆ©ç”¨è¯¾é—´æ—¶é—´ä»ä¸€é—´æ•™å®¤èµ¶åˆ°å¦ä¸€é—´æ•™å®¤ã€‚
>
>
> ç‰›ç‰›æ‰€åœ¨çš„å¤§å­¦æœ‰ $v$ ä¸ªæ•™å®¤ï¼Œæœ‰ $e$ æ¡é“è·¯ã€‚æ¯æ¡é“è·¯è¿æ¥ä¸¤é—´æ•™å®¤ï¼Œå¹¶ä¸”æ˜¯å¯ä»¥åŒå‘é€šè¡Œçš„ã€‚ç”±äºé“è·¯çš„é•¿åº¦å’Œæ‹¥å µç¨‹åº¦ä¸åŒï¼Œé€šè¿‡ä¸åŒçš„é“è·¯è€—è´¹çš„ä½“åŠ›å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒã€‚ å½“ç¬¬ $i$ï¼ˆ$1 \leq i \leq n-1$ï¼‰èŠ‚è¯¾ç»“æŸåï¼Œç‰›ç‰›å°±ä¼šä»è¿™èŠ‚è¯¾çš„æ•™å®¤å‡ºå‘ï¼Œé€‰æ‹©ä¸€æ¡è€—è´¹ä½“åŠ›æœ€å°‘çš„è·¯å¾„å‰å¾€ä¸‹ä¸€èŠ‚è¯¾çš„æ•™å®¤ã€‚
>
>
> ç°åœ¨ç‰›ç‰›æƒ³çŸ¥é“ï¼Œç”³è¯·å“ªå‡ é—¨è¯¾ç¨‹å¯ä»¥ä½¿ä»–å› åœ¨æ•™å®¤é—´ç§»åŠ¨è€—è´¹çš„ä½“åŠ›å€¼çš„æ€»å’Œçš„æœŸæœ›å€¼æœ€å°ï¼Œè¯·ä½ å¸®ä»–æ±‚å‡ºè¿™ä¸ªæœ€å°å€¼ã€‚
>
> ## è¾“å…¥æ ¼å¼
>
> ç¬¬ä¸€è¡Œå››ä¸ªæ•´æ•° $n,m,v,e$ã€‚$n$ è¡¨ç¤ºè¿™ä¸ªå­¦æœŸå†…çš„æ—¶é—´æ®µçš„æ•°é‡ï¼›$m$ è¡¨ç¤ºç‰›ç‰›æœ€å¤šå¯ä»¥ç”³è¯·æ›´æ¢å¤šå°‘èŠ‚è¯¾ç¨‹çš„æ•™å®¤ï¼›$v$ è¡¨ç¤ºç‰›ç‰›å­¦æ ¡é‡Œæ•™å®¤çš„æ•°é‡ï¼›$e$ è¡¨ç¤ºç‰›ç‰›çš„å­¦æ ¡é‡Œé“è·¯çš„æ•°é‡ã€‚
>
>
> ç¬¬äºŒè¡Œ $n$ ä¸ªæ­£æ•´æ•°ï¼Œç¬¬ $i$ï¼ˆ$1 \leq i \leq n$ï¼‰ä¸ªæ­£æ•´æ•°è¡¨ç¤º $c_i$ï¼Œå³ç¬¬ $i$ ä¸ªæ—¶é—´æ®µç‰›ç‰›è¢«å®‰æ’ä¸Šè¯¾çš„æ•™å®¤ï¼›ä¿è¯ $1 \le c_i \le v$ã€‚
>
>
> ç¬¬ä¸‰è¡Œ $n$ ä¸ªæ­£æ•´æ•°ï¼Œç¬¬ $i$ï¼ˆ$1 \leq i \leq n$ï¼‰ä¸ªæ­£æ•´æ•°è¡¨ç¤º $d_i$ï¼Œå³ç¬¬ $i$ ä¸ªæ—¶é—´æ®µå¦ä¸€é—´ä¸ŠåŒæ ·è¯¾ç¨‹çš„æ•™å®¤ï¼›ä¿è¯ $1 \le d_i \le v$ã€‚
>
>
> ç¬¬å››è¡Œ $n$ ä¸ªå®æ•°ï¼Œç¬¬ $i$ï¼ˆ$1 \leq i \leq n$ï¼‰ä¸ªå®æ•°è¡¨ç¤º $k_i$ï¼Œå³ç‰›ç‰›ç”³è¯·åœ¨ç¬¬ $i$ ä¸ªæ—¶é—´æ®µæ›´æ¢æ•™å®¤è·å¾—é€šè¿‡çš„æ¦‚ç‡ã€‚ä¿è¯ $0 \le k_i \le 1$ã€‚
>
>
> æ¥ä¸‹æ¥ $e$ è¡Œï¼Œæ¯è¡Œä¸‰ä¸ªæ­£æ•´æ•° $a_j, b_j, w_j$ï¼Œè¡¨ç¤ºæœ‰ä¸€æ¡åŒå‘é“è·¯è¿æ¥æ•™å®¤ $a_j, b_j$ï¼Œé€šè¿‡è¿™æ¡é“è·¯éœ€è¦è€—è´¹çš„ä½“åŠ›å€¼æ˜¯ $w_j$ï¼›ä¿è¯ $1 \le a_j, b_j \le v$ï¼Œ$1 \le w_j \le 100$ã€‚
>
>
> ä¿è¯ $1 \leq n \leq 2000$ï¼Œ$0 \leq m \leq 2000$ï¼Œ$1 \leq v \leq 300$ï¼Œ$0 \leq e \leq 90000$ã€‚
>
>
> ä¿è¯é€šè¿‡å­¦æ ¡é‡Œçš„é“è·¯ï¼Œä»ä»»ä½•ä¸€é—´æ•™å®¤å‡ºå‘ï¼Œéƒ½èƒ½åˆ°è¾¾å…¶ä»–æ‰€æœ‰çš„æ•™å®¤ã€‚
>
>
> ä¿è¯è¾“å…¥çš„å®æ•°æœ€å¤šåŒ…å« $3$ ä½å°æ•°ã€‚
>
> ## è¾“å‡ºæ ¼å¼
>
> è¾“å‡ºä¸€è¡Œï¼ŒåŒ…å«ä¸€ä¸ªå®æ•°ï¼Œå››èˆäº”å…¥ç²¾ç¡®åˆ°å°æ•°ç‚¹åæ°å¥½ $2$ ä½ï¼Œè¡¨ç¤ºç­”æ¡ˆã€‚ä½ çš„è¾“å‡ºå¿…é¡»å’Œæ ‡å‡†è¾“å‡ºå®Œå…¨ä¸€æ ·æ‰ç®—æ­£ç¡®ã€‚
>
> æµ‹è¯•æ•°æ®ä¿è¯å››èˆäº”å…¥åçš„ç­”æ¡ˆå’Œå‡†ç¡®ç­”æ¡ˆçš„å·®çš„ç»å¯¹å€¼ä¸å¤§äº $4 \times 10^{-3}$ã€‚ï¼ˆå¦‚æœä½ ä¸çŸ¥é“ä»€ä¹ˆæ˜¯æµ®ç‚¹è¯¯å·®ï¼Œè¿™æ®µè¯å¯ä»¥ç†è§£ä¸ºï¼šå¯¹äºå¤§å¤šæ•°çš„ç®—æ³•ï¼Œä½ å¯ä»¥æ­£å¸¸åœ°ä½¿ç”¨æµ®ç‚¹æ•°ç±»å‹è€Œä¸ç”¨å¯¹å®ƒè¿›è¡Œç‰¹æ®Šçš„å¤„ç†ï¼‰
>
> ## æ ·ä¾‹ #1
>
> ### æ ·ä¾‹è¾“å…¥ #1
>
> ```
> 3 2 3 3
> 2 1 2
> 1 2 1
> 0.8 0.2 0.5 
> 1 2 5
> 1 3 3
> 2 3 1
> ```
>
> ### æ ·ä¾‹è¾“å‡º #1
>
> ```
> 2.80
> ```
>
> ## æç¤º
>
> **æ ·ä¾‹ 1 è¯´æ˜**
>
> æ‰€æœ‰å¯è¡Œçš„ç”³è¯·æ–¹æ¡ˆå’ŒæœŸæœ›æ”¶ç›Šå¦‚ä¸‹ï¼š
>
> - ä¸ä½œç”³è¯·ï¼Œè€—è´¹çš„ä½“åŠ›å€¼çš„æœŸæœ›ä¸º $8.0$ã€‚
>
> | ç”³è¯·é€šè¿‡çš„æ—¶é—´æ®µ | å‡ºç°çš„æ¦‚ç‡ | è€—è´¹çš„ä½“åŠ›å€¼ |
> | :--------------: | :--------: | :----------: |
> |        æ—         |   $1.0$    |     $8$      |
>
> - ç”³è¯·æ›´æ¢ç¬¬ $1$ ä¸ªæ—¶é—´æ®µçš„ä¸Šè¯¾æ•™å®¤ï¼Œè€—è´¹çš„ä½“åŠ›å€¼çš„æœŸæœ›ä¸º $4.8$ã€‚
>
> | ç”³è¯·é€šè¿‡çš„æ—¶é—´æ®µ | å‡ºç°çš„æ¦‚ç‡ | è€—è´¹çš„ä½“åŠ›å€¼ |
> | :--------------: | :--------: | :----------: |
> |       $1$        |   $0.8$    |     $4$      |
> |        æ—         |   $0.2$    |     $8$      |
>
> - ç”³è¯·æ›´æ¢ç¬¬ $2$ ä¸ªæ—¶é—´æ®µçš„ä¸Šè¯¾æ•™å®¤ï¼Œè€—è´¹çš„ä½“åŠ›å€¼çš„æœŸæœ›ä¸º $6.4$ã€‚
>
> | ç”³è¯·é€šè¿‡çš„æ—¶é—´æ®µ | å‡ºç°çš„æ¦‚ç‡ | è€—è´¹çš„ä½“åŠ›å€¼ |
> | :--------------: | :--------: | :----------: |
> |       $2$        |   $0.2$    |     $0$      |
> |        æ—         |   $0.8$    |     $8$      |
>
> - ç”³è¯·æ›´æ¢ç¬¬ $3$ ä¸ªæ—¶é—´æ®µçš„ä¸Šè¯¾æ•™å®¤ï¼Œè€—è´¹çš„ä½“åŠ›å€¼çš„æœŸæœ›ä¸º $6.0$ã€‚
>
> | ç”³è¯·é€šè¿‡çš„æ—¶é—´æ®µ | å‡ºç°çš„æ¦‚ç‡ | è€—è´¹çš„ä½“åŠ›å€¼ |
> | :--------------: | :--------: | :----------: |
> |       $3$        |   $0.5$    |     $4$      |
> |        æ—         |   $0.5$    |     $8$      |
>
> - ç”³è¯·æ›´æ¢ç¬¬ $1,2$ ä¸ªæ—¶é—´æ®µçš„ä¸Šè¯¾æ•™å®¤ï¼Œè€—è´¹çš„ä½“åŠ›å€¼çš„æœŸæœ›ä¸º $4.48$ã€‚
>
> | ç”³è¯·é€šè¿‡çš„æ—¶é—´æ®µ | å‡ºç°çš„æ¦‚ç‡ | è€—è´¹çš„ä½“åŠ›å€¼ |
> | :--------------: | :--------: | :----------: |
> |      $1,2$       |   $0.16$   |     $4$      |
> |       $1$        |   $0.64$   |     $4$      |
> |       $2$        |   $0.04$   |     $0$      |
> |        æ—         |   $0.16$   |     $8$      |
>
> - ç”³è¯·æ›´æ¢ç¬¬ $1,3$ ä¸ªæ—¶é—´æ®µçš„ä¸Šè¯¾æ•™å®¤ï¼Œè€—è´¹çš„ä½“åŠ›å€¼çš„æœŸæœ›ä¸º $2.8$ã€‚
>
> | ç”³è¯·é€šè¿‡çš„æ—¶é—´æ®µ | å‡ºç°çš„æ¦‚ç‡ | è€—è´¹çš„ä½“åŠ›å€¼ |
> | :--------------: | :--------: | :----------: |
> |      $1,3$       |   $0.4$    |     $0$      |
> |       $1$        |   $0.4$    |     $4$      |
> |       $3$        |   $0.1$    |     $4$      |
> |        æ—         |   $0.1$    |     $8$      |
>
> - ç”³è¯·æ›´æ¢ç¬¬ $2,3$ ä¸ªæ—¶é—´æ®µçš„ä¸Šè¯¾æ•™å®¤ï¼Œè€—è´¹çš„ä½“åŠ›å€¼çš„æœŸæœ›ä¸º $5.2$ã€‚
>
> | ç”³è¯·é€šè¿‡çš„æ—¶é—´æ®µ | å‡ºç°çš„æ¦‚ç‡ | è€—è´¹çš„ä½“åŠ›å€¼ |
> | :--------------: | :--------: | :----------: |
> |      $2,3$       |   $0.1$    |     $4$      |
> |       $2$        |   $0.1$    |     $0$      |
> |       $3$        |   $0.4$    |     $4$      |
> |        æ—         |   $0.4$    |     $8$      |
>
> å› æ­¤ï¼Œæœ€ä¼˜æ–¹æ¡ˆä¸ºï¼šç”³è¯·æ›´æ¢ç¬¬ $1,3$ ä¸ªæ—¶é—´æ®µçš„ä¸Šè¯¾æ•™å®¤ã€‚è€—è´¹çš„ä½“åŠ›å€¼çš„æœŸæœ›ä¸º $2.8$ã€‚ 
>
> **æç¤º**
>
> 1. é“è·¯ä¸­å¯èƒ½ä¼šæœ‰å¤šæ¡åŒå‘é“è·¯è¿æ¥ç›¸åŒçš„ä¸¤é—´æ•™å®¤ã€‚ ä¹Ÿæœ‰å¯èƒ½æœ‰é“è·¯ä¸¤ç«¯è¿æ¥çš„æ˜¯åŒä¸€é—´æ•™å®¤ã€‚
> 2. è¯·æ³¨æ„åŒºåˆ† $n,m,v,e$ çš„æ„ä¹‰, $n$ ä¸æ˜¯æ•™å®¤çš„æ•°é‡, $m$ ä¸æ˜¯é“è·¯çš„æ•°é‡ã€‚
>
> **æ•°æ®èŒƒå›´ä¸è¯´æ˜**
>
> | æµ‹è¯•ç‚¹ç¼–å· | $n\le$ | $m\le$ | $v\le$ | æ˜¯å¦å…·æœ‰ç‰¹æ®Šæ€§è´¨ 1 | æ˜¯å¦å…·æœ‰ç‰¹æ®Šæ€§è´¨ 2 |
> | :--------: | :----: | :----: | :----: | :----------------: | :----------------: |
> |     1      |  $1$   |  $1$   | $300$  |      $\times$      |      $\times$      |
> |     2      |  $2$   |  $0$   |  $20$  |      $\times$      |      $\times$      |
> |     3      |  $2$   |  $1$   | $100$  |      $\times$      |      $\times$      |
> |     4      |  $2$   |  $2$   | $300$  |      $\times$      |      $\times$      |
> |     5      |  $3$   |  $0$   |  $20$  |      $\surd$       |      $\surd$       |
> |     6      |  $3$   |  $1$   | $100$  |      $\surd$       |      $\times$      |
> |     7      |  $3$   |  $2$   | $300$  |      $\times$      |      $\times$      |
> |     8      |  $10$  |  $0$   | $300$  |      $\surd$       |      $\surd$       |
> |     9      |  $10$  |  $1$   |  $20$  |      $\surd$       |      $\times$      |
> |     10     |  $10$  |  $2$   | $100$  |      $\times$      |      $\times$      |
> |     11     |  $10$  |  $10$  | $300$  |      $\times$      |      $\surd$       |
> |     12     |  $20$  |  $0$   |  $20$  |      $\surd$       |      $\times$      |
> |     13     |  $20$  |  $1$   | $100$  |      $\times$      |      $\times$      |
> |     14     |  $20$  |  $2$   | $300$  |      $\surd$       |      $\times$      |
> |     15     |  $20$  |  $20$  | $300$  |      $\times$      |      $\surd$       |
> |     16     | $300$  |  $0$   |  $20$  |      $\times$      |      $\times$      |
> |     17     | $300$  |  $1$   | $100$  |      $\times$      |      $\times$      |
> |     18     | $300$  |  $2$   | $300$  |      $\surd$       |      $\surd$       |
> |     19     | $300$  | $300$  | $300$  |      $\times$      |      $\surd$       |
> |     20     | $2000$ |  $0$   |  $20$  |      $\times$      |      $\times$      |
> |     21     | $2000$ |  $1$   |  $20$  |      $\times$      |      $\times$      |
> |     22     | $2000$ |  $2$   | $100$  |      $\times$      |      $\times$      |
> |     23     | $2000$ | $2000$ | $100$  |      $\times$      |      $\times$      |
> |     24     | $2000$ | $2000$ | $300$  |      $\times$      |      $\times$      |
> |     25     | $2000$ | $2000$ | $300$  |      $\times$      |      $\times$      |
>
>
> ç‰¹æ®Šæ€§è´¨ 1ï¼šå›¾ä¸Šä»»æ„ä¸åŒçš„ä¸¤ç‚¹ $u,v$ é—´ï¼Œå­˜åœ¨ä¸€æ¡è€—è´¹ä½“åŠ›æœ€å°‘çš„è·¯å¾„åªåŒ…å«ä¸€æ¡é“è·¯ã€‚
>
> ç‰¹æ®Šæ€§è´¨ 2ï¼šå¯¹äºæ‰€æœ‰çš„ $1â‰¤ iâ‰¤ n,\ k_i= 1$ã€‚

çŠ¶æ€è®¾è®¡ç»éªŒä¸è¶³ï¼Œå…¶å®æˆ‘çš„çŠ¶æ€å¤ªå¤æ‚å¯¼è‡´ä¸å¥½æ¨ã€‚

æˆ‘è®¾è®¡çš„çŠ¶æ€æ˜¯ $f_{ç¬¬ièŠ‚è¯¾,ç”¨äº†jæ¬¡æ¢è¯¾æœºä¼š,è¿™èŠ‚è¯¾æ˜¯å¦æ¢è¯¾æˆåŠŸ}$ çš„æœ€å°æœŸæœ›å€¼ï¼Œè¿™æ ·è®¾è®¡å°±ä¼šå¯¼è‡´æˆ‘éœ€è¦å¤„ç†ä¸ŠèŠ‚è¯¾æ˜¯å¦æ¢è¯¾ï¼Œè€Œæ˜¯å¦æˆåŠŸå­˜åœ¨åæ•ˆæ€§ï¼Œå¯¼è‡´æ— æ³•åšå‡ºã€‚

å…¶å®é¢˜è§£çš„çŠ¶æ€æ˜¯ $f_{ç¬¬ièŠ‚è¯¾,ç”¨äº†jæ¬¡æ¢è¯¾æœºä¼š,è¿™èŠ‚è¯¾\mathbf{æ˜¯å¦æ¢è¯¾}}$ çš„æœ€å°æœŸæœ›å€¼ï¼Œè¿™æ ·è®¾è®¡å°±åªéœ€è¦å¤„ç†ä¸ŠèŠ‚è¯¾æ˜¯å¦æ¢è¯¾æˆåŠŸï¼Œè€Œè¿™ä¸ªæ¦‚ç‡å·²ç»ç”±é¢˜ç›®ç»™å‡ºä¸º $k$ æ‰€ä»¥å¾ˆå®¹æ˜“ã€‚

è®­ç»ƒæ—¶å…¶å®è€ƒè™‘è¿‡æ›´æ¢çŠ¶æ€ï¼Œä½†æ˜¯åé¢å¹¶æ²¡æœ‰è¿™ä¹ˆåšã€‚

```c++
/**
 * @file æ¢æ•™å®¤.cpp 
 * @tag: #GMOJ#dp
 * @author: ZnPdCo
 * @date: 2024-01-11 20:57:17
 * @problem: https://gmoj.net/senior/#main/show/4905
 **/
#include <cstdio>
#include <algorithm>
using namespace std;
#define ll long long
#define N 2010
#define V 310
ll n, m, v, e;
ll c[N], d[N];
double k[N];
int dis[V][V];
double ans = 1e15;
double f[N][N][2];
// ç¬¬ièŠ‚è¯¾ æ¢äº†jæ¬¡ å½“å‰æ¢æ²¡æ¢
int main() {
	freopen("classroom.in", "r", stdin);
	freopen("classroom.out", "w", stdout);
	scanf("%lld %lld %lld %lld", &n, &m, &v, &e);
	for(ll i = 1; i <= n; i++) scanf("%lld", &c[i]);
	for(ll i = 1; i <= n; i++) scanf("%lld", &d[i]);
	for(ll i = 1; i <= n; i++) scanf("%lf", &k[i]);
	for(ll i = 1; i <= v; i++) {
		for(ll j = i+1; j <= v; j++) {
			dis[i][j] = dis[j][i] = 1e9;
		}
	}
	for(ll i = 1; i <= e; i++) {
		ll u, v, w;
		scanf("%lld %lld %lld", &u, &v, &w);
		if(w < dis[u][v]) {
			dis[u][v] = dis[v][u] = w;
		}
	}
	for(ll k = 1; k <= v; k++) {
		for(ll i = 1; i <= v; i++) {
			for(ll j = 1; j <= v; j++) {
				dis[i][j] = min(dis[i][j], dis[i][k]+dis[k][j]);
			}
		}
	}
	for(ll i = 1; i <= n; i++) {
		for(ll j = 0; j <= m; j++) {
			f[i][j][0] = f[i][j][1] = 1e15;
		}
	}
	f[1][0][0] = f[1][1][1] = 0;
	for(ll i = 2; i <= n; i++) {
		f[i][0][0] = f[i-1][0][0] + dis[c[i-1]][c[i]];
		for(ll j = 1; j <= m; j++) {
			f[i][j][0] = min(f[i-1][j][0] + dis[c[i-1]][c[i]],
				f[i-1][j][1] + k[i-1] * dis[d[i-1]][c[i]] + 
				(1-k[i-1]) * dis[c[i-1]][c[i]]);
			f[i][j][1] = min(f[i-1][j-1][0] + k[i] * dis[c[i-1]][d[i]] + 
				(1-k[i]) * dis[c[i-1]][c[i]],
				f[i-1][j-1][1] + k[i-1] * k[i] * dis[d[i-1]][d[i]] + 
				(1-k[i-1]) * k[i] * dis[c[i-1]][d[i]] + 
				k[i-1] * (1-k[i]) * dis[d[i-1]][c[i]] + 
				(1-k[i-1]) * (1-k[i]) * dis[c[i-1]][c[i]]);
		}
	}
	for(ll i = 0; i <= m; i++) {
		ans = min(ans, f[n][i][0]);
		ans = min(ans, f[n][i][1]);
	}
	printf("%.2lf", ans);
}
```

## T3 å¤©å¤©çˆ±è·‘æ­¥

> # [NOIP2016 æé«˜ç»„] å¤©å¤©çˆ±è·‘æ­¥
>
> ## é¢˜ç›®èƒŒæ™¯
>
> NOIP2016 æé«˜ç»„ D1T2
>
> ## é¢˜ç›®æè¿°
>
> å° C åŒå­¦è®¤ä¸ºè·‘æ­¥éå¸¸æœ‰è¶£ï¼Œäºæ˜¯å†³å®šåˆ¶ä½œä¸€æ¬¾å«åšã€Šå¤©å¤©çˆ±è·‘æ­¥ã€‹çš„æ¸¸æˆã€‚ã€Šå¤©å¤©çˆ±è·‘æ­¥ã€‹æ˜¯ä¸€ä¸ªå…»æˆç±»æ¸¸æˆï¼Œéœ€è¦ç©å®¶æ¯å¤©æŒ‰æ—¶ä¸Šçº¿ï¼Œå®Œæˆæ‰“å¡ä»»åŠ¡ã€‚
>
> è¿™ä¸ªæ¸¸æˆçš„åœ°å›¾å¯ä»¥çœ‹ä½œä¸€æ£µåŒ…å« $n$ ä¸ªç»“ç‚¹å’Œ $n-1$ æ¡è¾¹çš„æ ‘ï¼Œæ¯æ¡è¾¹è¿æ¥ä¸¤ä¸ªç»“ç‚¹ï¼Œä¸”ä»»æ„ä¸¤ä¸ªç»“ç‚¹å­˜åœ¨ä¸€æ¡è·¯å¾„äº’ç›¸å¯è¾¾ã€‚æ ‘ä¸Šç»“ç‚¹ç¼–å·ä¸ºä» $1$ åˆ° $n$ çš„è¿ç»­æ­£æ•´æ•°ã€‚
>
> ç°åœ¨æœ‰ $m$ ä¸ªç©å®¶ï¼Œç¬¬ $i$ ä¸ªç©å®¶çš„èµ·ç‚¹ä¸º $s_i$ï¼Œç»ˆç‚¹ä¸º $t_i$ã€‚æ¯å¤©æ‰“å¡ä»»åŠ¡å¼€å§‹æ—¶ï¼Œæ‰€æœ‰ç©å®¶åœ¨ç¬¬ $0$ ç§’åŒæ—¶ä»è‡ªå·±çš„èµ·ç‚¹å‡ºå‘ï¼Œä»¥æ¯ç§’è·‘ä¸€æ¡è¾¹çš„é€Ÿåº¦ï¼Œä¸é—´æ–­åœ°æ²¿ç€æœ€çŸ­è·¯å¾„å‘ç€è‡ªå·±çš„ç»ˆç‚¹è·‘å»ï¼Œè·‘åˆ°ç»ˆç‚¹åè¯¥ç©å®¶å°±ç®—å®Œæˆäº†æ‰“å¡ä»»åŠ¡ã€‚ï¼ˆç”±äºåœ°å›¾æ˜¯ä¸€æ£µæ ‘ï¼Œæ‰€ä»¥æ¯ä¸ªäººçš„è·¯å¾„æ˜¯å”¯ä¸€çš„ï¼‰
>
> å° C æƒ³çŸ¥é“æ¸¸æˆçš„æ´»è·ƒåº¦ï¼Œæ‰€ä»¥åœ¨æ¯ä¸ªç»“ç‚¹ä¸Šéƒ½æ”¾ç½®äº†ä¸€ä¸ªè§‚å¯Ÿå‘˜ã€‚åœ¨ç»“ç‚¹ $j$ çš„è§‚å¯Ÿå‘˜ä¼šé€‰æ‹©åœ¨ç¬¬ $w_j$ ç§’è§‚å¯Ÿç©å®¶ï¼Œä¸€ä¸ªç©å®¶èƒ½è¢«è¿™ä¸ªè§‚å¯Ÿå‘˜è§‚å¯Ÿåˆ°å½“ä¸”ä»…å½“è¯¥ç©å®¶åœ¨ç¬¬ $w_j$ ç§’ä¹Ÿæ­£å¥½åˆ°è¾¾äº†ç»“ç‚¹ $j$ã€‚å° C æƒ³çŸ¥é“æ¯ä¸ªè§‚å¯Ÿå‘˜ä¼šè§‚å¯Ÿåˆ°å¤šå°‘äºº?
>
> æ³¨æ„ï¼šæˆ‘ä»¬è®¤ä¸ºä¸€ä¸ªç©å®¶åˆ°è¾¾è‡ªå·±çš„ç»ˆç‚¹åè¯¥ç©å®¶å°±ä¼šç»“æŸæ¸¸æˆï¼Œä»–ä¸èƒ½ç­‰å¾…ä¸€ æ®µæ—¶é—´åå†è¢«è§‚å¯Ÿå‘˜è§‚å¯Ÿåˆ°ã€‚ å³å¯¹äºæŠŠç»“ç‚¹ $j$ ä½œä¸ºç»ˆç‚¹çš„ç©å®¶ï¼šè‹¥ä»–åœ¨ç¬¬ $w_j$ ç§’å‰åˆ°è¾¾ç»ˆç‚¹ï¼Œåˆ™åœ¨ç»“ç‚¹ $j$ çš„è§‚å¯Ÿå‘˜ä¸èƒ½è§‚å¯Ÿåˆ°è¯¥ç©å®¶ï¼›è‹¥ä»–æ­£å¥½åœ¨ç¬¬ $w_j$ ç§’åˆ°è¾¾ç»ˆç‚¹ï¼Œåˆ™åœ¨ç»“ç‚¹ $j$ çš„è§‚å¯Ÿå‘˜å¯ä»¥è§‚å¯Ÿåˆ°è¿™ä¸ªç©å®¶ã€‚
>
> ## è¾“å…¥æ ¼å¼
>
> ç¬¬ä¸€è¡Œæœ‰ä¸¤ä¸ªæ•´æ•° $n$ å’Œ $m$ã€‚å…¶ä¸­ $n$ ä»£è¡¨æ ‘çš„ç»“ç‚¹æ•°é‡, åŒæ—¶ä¹Ÿæ˜¯è§‚å¯Ÿå‘˜çš„æ•°é‡, $m$ ä»£è¡¨ç©å®¶çš„æ•°é‡ã€‚
>
> æ¥ä¸‹æ¥ $n-1$ è¡Œæ¯è¡Œä¸¤ä¸ªæ•´æ•° $u$ å’Œ $v$ï¼Œè¡¨ç¤ºç»“ç‚¹ $u$ åˆ°ç»“ç‚¹ $v$ æœ‰ä¸€æ¡è¾¹ã€‚
>
> æ¥ä¸‹æ¥ä¸€è¡Œ $n$ ä¸ªæ•´æ•°ï¼Œå…¶ä¸­ç¬¬ $j$ ä¸ªæ•´æ•°ä¸º $w_j$ , è¡¨ç¤ºç»“ç‚¹ $j$ å‡ºç°è§‚å¯Ÿå‘˜çš„æ—¶é—´ã€‚
>
> æ¥ä¸‹æ¥ $m$ è¡Œï¼Œæ¯è¡Œä¸¤ä¸ªæ•´æ•° $s_i$ï¼Œå’Œ $t_i$ï¼Œè¡¨ç¤ºä¸€ä¸ªç©å®¶çš„èµ·ç‚¹å’Œç»ˆç‚¹ã€‚
>
> å¯¹äºæ‰€æœ‰çš„æ•°æ®ï¼Œä¿è¯ $1\leq s_i,t_i\leq n, 0\leq w_j\leq n$ã€‚
>
> ## è¾“å‡ºæ ¼å¼
>
> è¾“å‡º $1$ è¡Œ $n$ ä¸ªæ•´æ•°ï¼Œç¬¬ $j$ ä¸ªæ•´æ•°è¡¨ç¤ºç»“ç‚¹ $j$ çš„è§‚å¯Ÿå‘˜å¯ä»¥è§‚å¯Ÿåˆ°å¤šå°‘äººã€‚
>
> ## æ ·ä¾‹ #1
>
> ### æ ·ä¾‹è¾“å…¥ #1
>
> ```
> 6 3
> 2 3
> 1 2 
> 1 4 
> 4 5 
> 4 6 
> 0 2 5 1 2 3 
> 1 5 
> 1 3 
> 2 6
> ```
>
> ### æ ·ä¾‹è¾“å‡º #1
>
> ```
> 2 0 0 1 1 1
> ```
>
> ## æ ·ä¾‹ #2
>
> ### æ ·ä¾‹è¾“å…¥ #2
>
> ```
> 5 3 
> 1 2 
> 2 3 
> 2 4 
> 1 5 
> 0 1 0 3 0 
> 3 1 
> 1 4
> 5 5
> ```
>
> ### æ ·ä¾‹è¾“å‡º #2
>
> ```
> 1 2 1 0 1
> ```
>
> ## æç¤º
>
> **æ ·ä¾‹ 1 è¯´æ˜**
>
> å¯¹äº $1$ å·ç‚¹ï¼Œ$w_i=0$ï¼Œæ•…åªæœ‰èµ·ç‚¹ä¸º $1$ å·ç‚¹çš„ç©å®¶æ‰ä¼šè¢«è§‚å¯Ÿåˆ°ï¼Œæ‰€ä»¥ç©å®¶ $1$ å’Œç©å®¶ $2$ è¢«è§‚å¯Ÿåˆ°ï¼Œå…±æœ‰ $2$ äººè¢«è§‚å¯Ÿåˆ°ã€‚
>
> å¯¹äº $2$ å·ç‚¹ï¼Œæ²¡æœ‰ç©å®¶åœ¨ç¬¬ $2$ ç§’æ—¶åœ¨æ­¤ç»“ç‚¹ï¼Œå…± $0$ äººè¢«è§‚å¯Ÿåˆ°ã€‚
>
> å¯¹äº $3$ å·ç‚¹ï¼Œæ²¡æœ‰ç©å®¶åœ¨ç¬¬ $5$ ç§’æ—¶åœ¨æ­¤ç»“ç‚¹ï¼Œå…± $0$ äººè¢«è§‚å¯Ÿåˆ°ã€‚
>
> å¯¹äº $4$ å·ç‚¹ï¼Œç©å®¶ $1$ è¢«è§‚å¯Ÿåˆ°ï¼Œå…± $1$ äººè¢«è§‚å¯Ÿåˆ°ã€‚
>
> å¯¹äº $5$ å·ç‚¹ï¼Œç©å®¶ $1$ è¢«è§‚å¯Ÿåˆ°ï¼Œå…± $1$ äººè¢«è§‚å¯Ÿåˆ°ã€‚
>
> å¯¹äº $6$ å·ç‚¹ï¼Œç©å®¶ $3$ è¢«è§‚å¯Ÿåˆ°ï¼Œå…± $1$ äººè¢«è§‚å¯Ÿåˆ°ã€‚
>
> **å­ä»»åŠ¡**
>
> æ¯ä¸ªæµ‹è¯•ç‚¹çš„æ•°æ®è§„æ¨¡åŠç‰¹ç‚¹å¦‚ä¸‹è¡¨æ‰€ç¤ºã€‚ 
>
> æç¤ºï¼šæ•°æ®èŒƒå›´çš„ä¸ªä½ä¸Šçš„æ•°å­—å¯ä»¥å¸®åŠ©åˆ¤æ–­æ˜¯å“ªä¸€ç§æ•°æ®ç±»å‹ã€‚
>
> | æµ‹è¯•ç‚¹ç¼–å·  |   $n=$   |   $m=$   |                             çº¦å®š                             |
> | :---------: | :------: | :------: | :----------------------------------------------------------: |
> |  $1\sim 2$  |  $991$   |  $991$   |     æ‰€æœ‰äººçš„èµ·ç‚¹ç­‰äºè‡ªå·±çš„ç»ˆç‚¹ï¼Œå³ $\forall i,\ s_i=t_i$     |
> |  $3\sim 4$  |  $992$   |  $992$   |                         æ‰€æœ‰ $w_j=0$                         |
> |     $5$     |  $993$   |  $993$   |                              æ—                               |
> |  $6\sim 8$  | $99994$  | $99994$  | $\forall i\in[1,n-1]$ï¼Œ$i$ ä¸ $i+1$ æœ‰è¾¹ã€‚å³æ ‘é€€åŒ–æˆ $1,2,\dots,n$ æŒ‰é¡ºåºè¿æ¥çš„é“¾ |
> | $9\sim 12$  | $99995$  | $99995$  |                         æ‰€æœ‰ $s_i=1$                         |
> | $13\sim 16$ | $99996$  | $99996$  |                         æ‰€æœ‰ $t_i=1$                         |
> | $17\sim 19$ | $99997$  | $99997$  |                              æ—                               |
> |    $20$     | $299998$ | $299998$ |                              æ—                               |
>
> **æç¤º**
>
> ï¼ˆæç¤ºï¼šç”±äºåŸæç¤ºå¹´ä»£ä¹…è¿œï¼Œä¸ä¸€å®šèƒ½å®Œå…¨åæ˜ ç°åœ¨çš„æƒ…å†µï¼Œç°åœ¨å·²ç»å¯¹è¯¥æç¤ºåšå‡ºäº†ä¸€å®šçš„ä¿®æ”¹ï¼Œæç¤ºçš„åŸæ–‡å¯ä»¥åœ¨[è¯¥å‰ªè´´æ¿](https://www.luogu.com.cn/paste/3fneb8m6)æŸ¥çœ‹ï¼‰
>
> åœ¨æœ€ç»ˆè¯„æµ‹æ—¶ï¼Œè°ƒç”¨æ ˆå ç”¨çš„ç©ºé—´å¤§å°ä¸ä¼šæœ‰å•ç‹¬çš„é™åˆ¶ï¼Œä½†åœ¨æˆ‘ä»¬çš„å·¥ä½œç¯å¢ƒä¸­é»˜è®¤ä¼šæœ‰ $1 \text{MiB}$ çš„é™åˆ¶ã€‚ è¿™å¯èƒ½ä¼šå¼•èµ·**å‡½æ•°è°ƒç”¨å±‚æ•°è¾ƒå¤šæ—¶ï¼Œç¨‹åºå‘ç”Ÿæ ˆæº¢å‡ºå´©æºƒ**ï¼Œç¨‹åºä¸­**è¾ƒæ·±å±‚æ•°çš„é€’å½’**å¾€å¾€ä¼šå¯¼è‡´è¿™ä¸ªé—®é¢˜ã€‚å¦‚æœä½ çš„ç¨‹åºéœ€è¦ç”¨åˆ°è¾ƒå¤§çš„æ ˆç©ºé—´ï¼Œè¯·åŠ¡å¿…æ³¨æ„è¯¥é—®é¢˜ã€‚
>
> æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€äº›æ–¹æ³•ä¿®æ”¹è°ƒç”¨æ ˆçš„å¤§å°é™åˆ¶ã€‚
>
> - Linux
>
> æˆ‘ä»¬å¯ä»¥åœ¨ç»ˆç«¯ä¸­è¾“å…¥ä¸‹åˆ—å‘½ä»¤ï¼š`ulimit -s 1048576`ã€‚æ­¤å‘½ä»¤çš„æ„ä¹‰æ˜¯ï¼Œå°†è°ƒç”¨æ ˆçš„å¤§å°é™åˆ¶ä¿®æ”¹ä¸º $1048576\text{KiB}=1 \text{GiB}$ã€‚
>
> ä¾‹å¦‚ï¼Œå¯¹äºå¦‚ä¸‹ç¨‹åº `sample.cpp`ï¼š
>
> ```cpp
> #include <bits/stdc++.h>
> using namespace std;
> int f[1000005];
> void dfs(int a){
> 	if(a == 0){
> 		f[a] = 0;
> 		return;
> 	}
> 	dfs(a - 1);
> 	f[a] = f[a - 1] + 1;
> }
> int main(){
> 	dfs(1000000);
> 	return 0;
> }
> ```
>
> å°†ä¸Šè¿°æºä»£ç ç”¨å‘½ä»¤ `g++ sample.cpp -o sample` ç¼–è¯‘ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ `sample` åï¼Œä½¿ç”¨ `./sample` æ‰§è¡Œç¨‹åºã€‚
>
> å¦‚æœåœ¨æ²¡æœ‰ä½¿ç”¨å‘½ä»¤ `ulimit -s 1048576` çš„æƒ…å†µä¸‹è¿è¡Œè¯¥ç¨‹åºï¼Œ`sample` ä¼šå› ä¸ºæ ˆæº¢å‡ºè€Œå´©æºƒï¼›å¦‚æœä½¿ç”¨äº†ä¸Šè¿°å‘½ä»¤åè¿è¡Œè¯¥ç¨‹åºï¼Œè¯¥ç¨‹åºåˆ™ä¸ä¼šå´©æºƒã€‚
>
> ç‰¹åˆ«åœ°ï¼Œå½“ä½ æ‰“å¼€å¤šä¸ªç»ˆç«¯æ—¶ï¼Œå®ƒä»¬å¹¶ä¸ä¼šå…±äº«è¯¥å‘½ä»¤ï¼Œä½ éœ€è¦åˆ†åˆ«å¯¹å®ƒä»¬è¿è¡Œè¯¥å‘½ä»¤ã€‚
>
> è¯·æ³¨æ„ï¼Œè°ƒç”¨æ ˆå ç”¨çš„ç©ºé—´ä¼šè®¡å…¥æ€»ç©ºé—´å ç”¨ä¸­ï¼Œå’Œç¨‹åºå…¶ä»–éƒ¨åˆ†å ç”¨çš„å†…å­˜å…±åŒå—åˆ°å†…å­˜é™åˆ¶ã€‚
>
> - Windows
>
> å¦‚æœä½ ä½¿ç”¨ Windows ä¸‹çš„ Dev-C++ï¼Œè¯·é€‰æ‹© `å·¥å…·-ç¼–è¯‘é€‰é¡¹` å¹¶åœ¨å¦‚ä¸‹åŒºåŸŸå¡«å…¥ä»¥ä¸‹å‘½ä»¤ `-Wl,--stack=1073741824`ï¼Œå¡«å…¥åæ³¨æ„ç¡®è®¤â€œç¼–è¯‘æ—¶åŠ å…¥ä»¥ä¸‹å‘½ä»¤çš„â€çš„æ¡†æ˜¯**å·²å‹¾é€‰**çŠ¶æ€ã€‚
>
> æ­¤å¤„ `1073741824` çš„å•ä½æ˜¯ $\text{B/Bytes}$ã€‚
>
> ![](https://cdn.luogu.com.cn/upload/image_hosting/z6mbzfqo.png)  ![](https://cdn.luogu.com.cn/upload/image_hosting/zvrzkyq5.png)

ä»¥ä¸ºæ˜¯æ ‘é“¾å‰–åˆ†ï¼Œå…¶å®ä¹Ÿå¥½ç†è§£ã€‚

è€ƒè™‘æŠŠ $s\to t$ å˜æˆ $s\to\text{lca}\to t$ï¼Œç„¶ååˆ†æˆä¸¤ä¸ªé“¾ã€‚

ç½‘ä¸Šæ¨å¯¼å¾ˆå¤šäº†ï¼Œåœ¨ $s\to\text{lca}$ ä¸­æœ‰ $\text{dep}_s=\text{dep}_{\text{lca}}-w_{\text{lca}}$ï¼›åœ¨ $\text{lca}\to t$ ä¸­æœ‰ $\text{dist}_{s,t}-\text{dep}_t=w_{\text{lca}}-\text{dep}_{\text{lca}}$ã€‚

æ˜æ˜¾å¯ä»¥æ”¾è¿›æ¡¶å†…ç»Ÿè®¡ï¼Œå›°æ‰°æˆ‘çš„å°±æ˜¯æ€ä¹ˆä¿è¯ $s,t$ åœ¨ lca å­æ ‘å†…ï¼Œè¿™ä¸ªå¯ä»¥ç”¨ dfs æ—¶é¡ºå¸¦å¤„ç†ï¼Œåˆ°è¾¾ä¸€ä¸ªç‚¹åæœ‰æ·»åŠ æ“ä½œï¼Œç¦»å¼€ä¸€ä¸ª lca åæœ‰åˆ é™¤æ“ä½œï¼Œè®°å½•å·®å€¼å³å¯ã€‚

```c++
/**
 * @file å¤©å¤©çˆ±è·‘æ­¥.cpp 
 * @tag: #GMOJ#æ¡¶#LCA
 * @author: ZnPdCo
 * @date: 2024-01-11 20:57:17
 * @problem: https://gmoj.net/senior/#main/show/4904
 **/
#include <cstdio>
#include <algorithm>
#include <vector>
#define ll long long
#define N 300000
using namespace std;
ll n, m;
ll head[N];
ll nxt[2*N];
ll to[2*N], cnt;
ll w[N], s[N], t[N];
ll ans[N];

void addEdge(ll u, ll v) {
	cnt++;
	to[cnt] = v;
	nxt[cnt] = head[u];
	head[u] = cnt;
}

ll f[N][30], dep[N];
ll logn[N];
void dfs(ll u, ll fa) {
	dep[u] = dep[fa] + 1;
	f[u][0] = fa;
	for(ll i = head[u]; i; i = nxt[i]) {
		ll v = to[i];
		if(v == fa) continue;
		dfs(v, u);
	}
}
ll LCA(ll x, ll y) {
	if(dep[x] < dep[y]) swap(x, y);
	while(dep[x] != dep[y]) x = f[x][logn[dep[x]-dep[y]]];
	if(x == y) return x;
	for(ll i = logn[dep[x]]; i >= 0; i--) {
		if(f[x][i] && f[y][i] && f[x][i] != f[y][i]) {
			x = f[x][i];
			y = f[y][i];
		}
	}
	return f[x][0];
}

vector<pair<ll, ll> > opt1[N], opt2[N];
ll b1[N], b2[2*N];
void dfs1(ll u, ll fa) {
	ll od = b1[dep[u]+w[u]];
	for(ll i = head[u]; i; i = nxt[i]) {
		ll v = to[i];
		if(v == fa) continue;
		dfs1(v, u);
	}
	for(auto x : opt1[u]) {
		b1[x.first] += x.second;
	}
	ll nw = b1[dep[u]+w[u]];
	ans[u] += nw-od;
}
void dfs2(ll u, ll fa) {
	ll od = b2[w[u]-dep[u]+N];
	for(ll i = head[u]; i; i = nxt[i]) {
		ll v = to[i];
		if(v == fa) continue;
		dfs2(v, u);
	}
	for(auto x : opt2[u]) {
		b2[x.first+N] += x.second;
	}
	ll nw = b2[w[u]-dep[u]+N];
	ans[u] += nw-od;
}

int main() {
	freopen("running.in", "r", stdin);
	freopen("running.out", "w", stdout);
	scanf("%lld %lld", &n, &m);
	logn[1] = 0;
	for(ll i = 2; i <= n; i++) {
		logn[i] = logn[i>>1]+1;
	}
	for(ll i = 1; i < n; i++) {
		ll u, v;
		scanf("%lld %lld", &u, &v);
		addEdge(u, v);
		addEdge(v, u);
	}
	dfs(1, 0);
	for(ll j = 1; j <= 20; j++) {
		for(ll i = 1; i <= n; i++) {
			f[i][j] = f[f[i][j-1]][j-1];
		}
	}
	for(ll i = 1; i <= n; i++) {
		scanf("%lld", &w[i]);
	}
	for(ll i = 1; i <= m; i++) {
		scanf("%lld %lld", &s[i], &t[i]);
		ll ca = LCA(s[i], t[i]);
		// dep_s=dep_{ca}-w_{ca}
		opt1[s[i]].push_back(make_pair(dep[s[i]], 1));	// åœ¨åˆ°è¾¾s[i]æ—¶æ·»åŠ è´¡çŒ®
		opt1[ca].push_back(make_pair(dep[s[i]], -1));	// åœ¨ç¦»å¼€ä¼šç»Ÿè®¡s[i]çš„lcaæ—¶åˆ é™¤è´¡çŒ®
	}
	dfs1(1, 0);
	for(ll i = 1; i <= m; i++) {
		ll ca = LCA(s[i], t[i]);
		ll dist = dep[s[i]] + dep[t[i]] - 2*dep[ca];
		// dist_{s,t}-w_{ca}=dep_t-dep_{ca}
		// dist_{s,t}-dep_t=w_{ca}-dep_{ca}
		opt2[t[i]].push_back(make_pair(dist - dep[t[i]], 1));		// åœ¨åˆ°è¾¾t[i]æ—¶æ·»åŠ è´¡çŒ®
		opt2[f[ca][0]].push_back(make_pair(dist - dep[t[i]], -1));	// åœ¨ç¦»å¼€ä¼šç»Ÿè®¡t[i]çš„lcaæ—¶åˆ é™¤è´¡çŒ®
		// è¿™é‡Œä¸ºäº†ç»Ÿè®¡lcaè‡ªå·±
	}
	dfs2(1, 0);
	for(ll i = 1; i <= n; i++) {
		printf("%lld ", ans[i]);
	}
}
```

## T4 èš¯èš“

> # [NOIP2016 æé«˜ç»„] èš¯èš“
>
> ## é¢˜ç›®èƒŒæ™¯
>
> NOIP2016 æé«˜ç»„ D2T2
>
> ## é¢˜ç›®æè¿°
>
> æœ¬é¢˜ä¸­ï¼Œæˆ‘ä»¬å°†ç”¨ç¬¦å· $\lfloor c \rfloor$ è¡¨ç¤ºå¯¹ $c$ å‘ä¸‹å–æ•´ï¼Œä¾‹å¦‚ï¼š$\lfloor 3.0 \rfloor = \lfloor 3.1 \rfloor = \lfloor 3.9 \rfloor = 3$ã€‚
>
> è›è›å›½æœ€è¿‘èš¯èš“æˆç¾äº†ï¼éš”å£è·³èš¤å›½çš„è·³èš¤ä¹Ÿæ‹¿èš¯èš“ä»¬æ²¡åŠæ³•ï¼Œè›è›å›½ç‹åªå¥½å»è¯·ç¥åˆ€æ‰‹æ¥å¸®ä»–ä»¬æ¶ˆç­èš¯èš“ã€‚
>
> è›è›å›½é‡Œç°åœ¨å…±æœ‰ $n$ åªèš¯èš“ï¼ˆ$n$ ä¸ºæ­£æ•´æ•°ï¼‰ã€‚æ¯åªèš¯èš“æ‹¥æœ‰é•¿åº¦ï¼Œæˆ‘ä»¬è®¾ç¬¬ $i$ åªèš¯èš“çš„é•¿åº¦ä¸º $a_i\,(i=1,2,\dots,n)$ï¼Œå¹¶ä¿è¯æ‰€æœ‰çš„é•¿åº¦éƒ½æ˜¯éè´Ÿæ•´æ•°ï¼ˆå³ï¼šå¯èƒ½å­˜åœ¨é•¿åº¦ä¸º $0$ çš„èš¯èš“ï¼‰ã€‚
>
> æ¯ä¸€ç§’ï¼Œç¥åˆ€æ‰‹ä¼šåœ¨æ‰€æœ‰çš„èš¯èš“ä¸­ï¼Œå‡†ç¡®åœ°æ‰¾åˆ°æœ€é•¿çš„é‚£ä¸€åªï¼ˆå¦‚æœ‰å¤šä¸ªåˆ™ä»»é€‰ä¸€ä¸ªï¼‰å°†å…¶åˆ‡æˆä¸¤åŠã€‚ç¥åˆ€æ‰‹åˆ‡å¼€èš¯èš“çš„ä½ç½®ç”±å¸¸æ•° $p$ï¼ˆæ˜¯æ»¡è¶³ $0 < p < 1$ çš„æœ‰ç†æ•°ï¼‰å†³å®šï¼Œè®¾è¿™åªèš¯èš“é•¿åº¦ä¸º $x$ï¼Œç¥åˆ€æ‰‹ä¼šå°†å…¶åˆ‡æˆä¸¤åªé•¿åº¦åˆ†åˆ«ä¸º $\lfloor px \rfloor$ å’Œ $x - \lfloor px \rfloor$ çš„èš¯èš“ã€‚ç‰¹æ®Šåœ°ï¼Œå¦‚æœè¿™ä¸¤ä¸ªæ•°çš„å…¶ä¸­ä¸€ä¸ªç­‰äº $0$ï¼Œåˆ™è¿™ä¸ªé•¿åº¦ä¸º $0$ çš„èš¯èš“ä¹Ÿä¼šè¢«ä¿ç•™ã€‚æ­¤å¤–ï¼Œé™¤äº†åˆšåˆšäº§ç”Ÿçš„ä¸¤åªæ–°èš¯èš“ï¼Œå…¶ä½™èš¯èš“çš„é•¿åº¦éƒ½ä¼šå¢åŠ  $q$ï¼ˆæ˜¯ä¸€ä¸ªéè´Ÿæ•´å¸¸æ•°ï¼‰ã€‚
>
> è›è›å›½ç‹çŸ¥é“è¿™æ ·ä¸æ˜¯é•¿ä¹…ä¹‹è®¡ï¼Œå› ä¸ºèš¯èš“ä¸ä»…ä¼šè¶Šæ¥è¶Šå¤šï¼Œè¿˜ä¼šè¶Šæ¥è¶Šé•¿ã€‚è›è›å›½ç‹å†³å®šæ±‚åŠ©äºä¸€ä½æœ‰ç€æ´ªè’ä¹‹åŠ›çš„ç¥ç§˜äººç‰©ï¼Œä½†æ˜¯æ•‘å…µè¿˜éœ€è¦ $m$ ç§’æ‰èƒ½åˆ°æ¥â€¦â€¦ï¼ˆ$m$ ä¸ºéè´Ÿæ•´æ•°ï¼‰
>
> è›è›å›½ç‹å¸Œæœ›çŸ¥é“è¿™ $m$ ç§’å†…çš„æˆ˜å†µã€‚å…·ä½“æ¥è¯´ï¼Œä»–å¸Œæœ›çŸ¥é“ï¼š
>
> - $m$ ç§’å†…ï¼Œæ¯ä¸€ç§’è¢«åˆ‡æ–­çš„èš¯èš“è¢«åˆ‡æ–­å‰çš„é•¿åº¦ï¼ˆæœ‰ $m$ ä¸ªæ•°ï¼‰ï¼›
> - $m$ ç§’åï¼Œæ‰€æœ‰èš¯èš“çš„é•¿åº¦ï¼ˆæœ‰ $n + m$ ä¸ªæ•°ï¼‰ã€‚
>
> è›è›å›½ç‹å½“ç„¶çŸ¥é“æ€ä¹ˆåšå•¦ï¼ä½†æ˜¯ä»–æƒ³è€ƒè€ƒä½ â€¦â€¦
>
> ## è¾“å…¥æ ¼å¼
>
> ç¬¬ä¸€è¡ŒåŒ…å«å…­ä¸ªæ•´æ•° $n,m,q,u,v,t$ï¼Œå…¶ä¸­ï¼š$n,m,q$ çš„æ„ä¹‰è§ã€é—®é¢˜æè¿°ã€‘ï¼›$u,v,t$ å‡ä¸ºæ­£æ•´æ•°ï¼›ä½ éœ€è¦è‡ªå·±è®¡ç®— $p=u / v$ï¼ˆä¿è¯ $0 < u < v$ï¼‰ï¼›$t$ æ˜¯è¾“å‡ºå‚æ•°ï¼Œå…¶å«ä¹‰å°†ä¼šåœ¨ã€è¾“å‡ºæ ¼å¼ã€‘ä¸­è§£é‡Šã€‚
>
> ç¬¬äºŒè¡ŒåŒ…å« $n$ ä¸ªéè´Ÿæ•´æ•°ï¼Œä¸º $a_1, a_2, \dots, a_n$ï¼Œå³åˆå§‹æ—¶ $n$ åªèš¯èš“çš„é•¿åº¦ã€‚
>
> åŒä¸€è¡Œä¸­ç›¸é‚»çš„ä¸¤ä¸ªæ•°ä¹‹é—´ï¼Œæ°å¥½ç”¨ä¸€ä¸ªç©ºæ ¼éš”å¼€ã€‚
>
> ä¿è¯ $1 \leq n \leq 10^5$ï¼Œ$0 \leq m \leq 7 \times 10^6$ï¼Œ$0 < u < v \leq 10^9$ï¼Œ$0 \leq q \leq 200$ï¼Œ$1 \leq t \leq 71$ï¼Œ$0 \leq a_i \leq 10^8$ã€‚
>
> ## è¾“å‡ºæ ¼å¼
>
> ç¬¬ä¸€è¡Œè¾“å‡º $\left \lfloor \frac{m}{t} \right \rfloor$ ä¸ªæ•´æ•°ï¼ŒæŒ‰æ—¶é—´é¡ºåºï¼Œä¾æ¬¡è¾“å‡ºç¬¬ $t$ ç§’ï¼Œç¬¬ $2t$ ç§’ï¼Œç¬¬ $3t$ ç§’ï¼Œâ€¦â€¦è¢«åˆ‡æ–­èš¯èš“ï¼ˆåœ¨è¢«åˆ‡æ–­å‰ï¼‰çš„é•¿åº¦ã€‚
>
> ç¬¬äºŒè¡Œè¾“å‡º $\left \lfloor \frac{n+m}{t} \right \rfloor$ ä¸ªæ•´æ•°ï¼Œè¾“å‡º $m$ ç§’åèš¯èš“çš„é•¿åº¦ï¼›éœ€è¦æŒ‰ä»å¤§åˆ°å°çš„é¡ºåºï¼Œä¾æ¬¡è¾“å‡ºæ’åç¬¬ $t$ï¼Œç¬¬ $2t$ï¼Œç¬¬ $3t$ï¼Œâ€¦â€¦çš„é•¿åº¦ã€‚
>
> åŒä¸€è¡Œä¸­ç›¸é‚»çš„ä¸¤ä¸ªæ•°ä¹‹é—´ï¼Œæ°å¥½ç”¨ä¸€ä¸ªç©ºæ ¼éš”å¼€ã€‚å³ä½¿æŸä¸€è¡Œæ²¡æœ‰ä»»ä½•æ•°éœ€è¦è¾“å‡ºï¼Œä½ ä¹Ÿåº”è¾“å‡ºä¸€ä¸ªç©ºè¡Œã€‚
>
> è¯·é˜…è¯»æ ·ä¾‹æ¥æ›´å¥½åœ°ç†è§£è¿™ä¸ªæ ¼å¼ã€‚
>
> ## æ ·ä¾‹ #1
>
> ### æ ·ä¾‹è¾“å…¥ #1
>
> ```
> 3 7 1 1 3 1
> 3 3 2
> ```
>
> ### æ ·ä¾‹è¾“å‡º #1
>
> ```
> 3 4 4 4 5 5 6
> 6 6 6 5 5 4 4 3 2 2
> ```
>
> ## æ ·ä¾‹ #2
>
> ### æ ·ä¾‹è¾“å…¥ #2
>
> ```
> 3 7 1 1 3 2
> 3 3 2
> ```
>
> ### æ ·ä¾‹è¾“å‡º #2
>
> ```
> 4 4 5
> 6 5 4 3 2
> ```
>
> ## æ ·ä¾‹ #3
>
> ### æ ·ä¾‹è¾“å…¥ #3
>
> ```
> 3 7 1 1 3 9
> 3 3 2
> ```
>
> ### æ ·ä¾‹è¾“å‡º #3
>
> ```
> //ç©ºè¡Œ
> 2
> ```
>
> ## æç¤º
>
> **æ ·ä¾‹è§£é‡Š 1**
>
> åœ¨ç¥åˆ€æ‰‹åˆ°æ¥å‰ï¼š$3$ åªèš¯èš“çš„é•¿åº¦ä¸º $3,3,2$ã€‚
>
> $1$ ç§’åï¼šä¸€åªé•¿åº¦ä¸º $3$ çš„èš¯èš“è¢«åˆ‡æˆäº†ä¸¤åªé•¿åº¦åˆ†åˆ«ä¸º$1$ å’Œ $2$ çš„èš¯èš“ï¼Œå…¶ä½™èš¯èš“çš„é•¿åº¦å¢åŠ äº† $1$ã€‚æœ€ç»ˆ $4$ åªèš¯èš“çš„é•¿åº¦åˆ†åˆ«ä¸º $(1,2),4,3$ã€‚æ‹¬å·è¡¨ç¤ºè¿™ä¸ªä½ç½®åˆšåˆšæœ‰ä¸€åªèš¯èš“è¢«åˆ‡æ–­ã€‚
>
> $2$ ç§’åï¼šä¸€åªé•¿åº¦ä¸º $4$ çš„èš¯èš“è¢«åˆ‡æˆäº† $1$ å’Œ $3$ã€‚$5$ åªèš¯èš“çš„é•¿åº¦åˆ†åˆ«ä¸ºï¼š$2,3,(1,3),4$ã€‚
>
> $3$ ç§’åï¼šä¸€åªé•¿åº¦ä¸º $4$ çš„èš¯èš“è¢«åˆ‡æ–­ã€‚$6$ åªèš¯èš“çš„é•¿åº¦åˆ†åˆ«ä¸ºï¼š$3,4,2,4,(1,3)$ã€‚
>
> $4$ ç§’åï¼šä¸€åªé•¿åº¦ä¸º $4$ çš„èš¯èš“è¢«åˆ‡æ–­ã€‚$7$ åªèš¯èš“çš„é•¿åº¦åˆ†åˆ«ä¸ºï¼š$4,(1,3),3,5,2,4$ã€‚
>
> $5$ ç§’åï¼šä¸€åªé•¿åº¦ä¸º $5$ çš„èš¯èš“è¢«åˆ‡æ–­ã€‚$8$ åªèš¯èš“çš„é•¿åº¦åˆ†åˆ«ä¸ºï¼š$5,2,4,4,(1,4),3,5$ã€‚
>
> $6$ ç§’åï¼šä¸€åªé•¿åº¦ä¸º $5$ çš„èš¯èš“è¢«åˆ‡æ–­ã€‚$9$ åªèš¯èš“çš„é•¿åº¦åˆ†åˆ«ä¸ºï¼š$(1,4),3,5,5,2,5,4,6$ã€‚
>
> $7$ ç§’åï¼šä¸€åªé•¿åº¦ä¸º $6$ çš„èš¯èš“è¢«åˆ‡æ–­ã€‚$10$ åªèš¯èš“çš„é•¿åº¦åˆ†åˆ«ä¸ºï¼š$2,5,4,6,6,3,6,5,(2,4)$ã€‚æ‰€ä»¥ï¼Œ$7$ ç§’å†…è¢«åˆ‡æ–­çš„èš¯èš“çš„é•¿åº¦ä¾æ¬¡ä¸º $3,4,4,4,5,5,6$ã€‚$7$ ç§’åï¼Œæ‰€æœ‰èš¯èš“é•¿åº¦ä»å¤§åˆ°å°æ’åºä¸º $6,6,6,5,5,4,4,3,2,2$ã€‚
>
> **æ ·ä¾‹è§£é‡Š 2**
>
> è¿™ä¸ªæ•°æ®ä¸­åªæœ‰ $t=2$ ä¸ä¸Šä¸ªæ•°æ®ä¸åŒã€‚åªéœ€åœ¨æ¯è¡Œéƒ½æ”¹ä¸ºæ¯ä¸¤ä¸ªæ•°è¾“å‡ºä¸€ä¸ªæ•°å³å¯ã€‚
>
> è™½ç„¶ç¬¬ä¸€è¡Œæœ€åæœ‰ä¸€ä¸ª $6$ æ²¡æœ‰è¢«è¾“å‡ºï¼Œä½†æ˜¯ç¬¬äºŒè¡Œä»ç„¶è¦é‡æ–°ä»ç¬¬äºŒä¸ªæ•°å†å¼€å§‹è¾“å‡ºã€‚
>
> **æ ·ä¾‹è§£é‡Š 3**
>
> è¿™ä¸ªæ•°æ®ä¸­åªæœ‰ $t=9$ ä¸ä¸Šä¸ªæ•°æ®ä¸åŒã€‚
>
> æ³¨æ„ç¬¬ä¸€è¡Œæ²¡æœ‰æ•°è¦è¾“å‡ºï¼Œä½†ä¹Ÿè¦è¾“å‡ºä¸€ä¸ªç©ºè¡Œã€‚
>
>
> **æ•°æ®èŒƒå›´**
>
> ![](https://cdn.luogu.com.cn/upload/pic/3458.png)

ä»¥ä¸ºæ˜¯æ°´é¢˜ï¼Œæ²¡çœ‹æ•°æ®èŒƒå›´æ‰“äº†ä¸€ä¸ª $O((n+m)\log (n+m))$ çš„åšæ³•ï¼Œå¯¹äºå…¨å±€åŠ å¯ä»¥çœ‹ä½œæ˜¯è‡ªå·±å‡ã€‚

ä¸­åˆæ²¡çœ‹é¢˜è§£å›å»èººåœ¨åºŠä¸Šè‡ªå·±å°±æƒ³åˆ°äº†çº¿æ€§åšæ³•ï¼Œä»¥ååšé¢˜æ—¶ä¸€å®šè¦æµ‹æé™æ•°æ®å‘€ï¼

ç„¶åå¯ä»¥æ„Ÿæ€§ç†è§£çº¿æ€§åšæ³•ï¼Œå…ˆä¸çœ‹æ¯æ¬¡ç”Ÿé•¿çš„ $q$ï¼Œæ¯æ¬¡å–å‡ºçš„ä¼šè¢«åˆ†è£‚ï¼Œæ‰€ä»¥é•¿åº¦ä¸€å®šæ˜¯è¶Šæ¥è¶ŠçŸ­ï¼Œå¯ä»¥ç»´æŠ¤ä¸‰ä¸ªé˜Ÿåˆ—æ¥åšï¼Œåˆ†åˆ«å‚¨å­˜åŸæœ¬çš„ï¼Œåˆ†è£‚çš„è¾ƒå¤§éƒ¨åˆ†ï¼Œåˆ†è£‚è¾ƒå°éƒ¨åˆ†ï¼Œç„¶åæ¯æ¬¡é•¿åº¦è‚¯å®šæ˜¯é˜Ÿåˆ—ä¸­æœ€çŸ­çš„ï¼Œæ‰€ä»¥å¯ä»¥æ”¾å¿ƒåŠ åˆ°é˜Ÿå°¾ã€‚

è‡³äºç”Ÿé•¿çš„ $q$ï¼ŒåŒç†å¯ä»¥çœ‹ä½œæ˜¯è‡ªå·±å‡ã€‚

```c++
/**
 * @file èš¯èš“.cpp 
 * @tag: #GMOJ#é˜Ÿåˆ—#æ•°å­¦
 * @author: ZnPdCo
 * @date: 2024-01-11 20:57:17
 * @problem: https://gmoj.net/senior/#main/show/4907
 **/
#include <cstdio>
#include <algorithm>
using namespace std;
#define ll long long
#define N 8000010
ll n, m, q, u, v, t;

ll a1[N], h1=1, t1, a2[N], h2=1, t2, a3[N], h3=1, t3, tot;
bool cmp(ll x, ll y) {
	return x > y;
}
int main() {
	freopen("earthworm.in", "r", stdin);
	freopen("earthworm.out", "w", stdout);
	
	scanf("%lld %lld %lld %lld %lld %lld", &n, &m, &q, &u, &v, &t);
	for(ll i = 1; i <= n; i++) {
		scanf("%lld", &a1[++t1]);
	}
	sort(a1+1, a1+1+n, cmp);
	for(ll i = 1; i <= m; i++) {
		ll head1 = h1<=t1?a1[h1] + q*(i-1):-1;
		ll head2 = h2<=t2?a2[h2] + q*(i-1):-1;
		ll head3 = h3<=t3?a3[h3] + q*(i-1):-1;
		if(head1 >= head2 && head1 >= head3) {
			if(i % t == 0) printf("%lld ", head1);
			h1++;
			a2[++t2] = head1 * u / v - q*i;
			a3[++t3] = head1 - head1 * u / v - q*i;
		} else if(head2 >= head1 && head2 >= head3) {
			if(i % t == 0) printf("%lld ", head2);
			h2++;
			a2[++t2] = head2 * u / v - q*i;
			a3[++t3] = head2 - head2 * u / v - q*i;
		} else {
			if(i % t == 0) printf("%lld ", head3);
			h3++;
			a2[++t2] = head3 * u / v - q*i;
			a3[++t3] = head3 - head3 * u / v - q*i;
		}
	}
	printf("\n");
	for(ll i = 1; i <= n+m; i++) {
		ll head1 = h1<=t1?a1[h1] + q*m:-1;
		ll head2 = h2<=t2?a2[h2] + q*m:-1;
		ll head3 = h3<=t3?a3[h3] + q*m:-1;
		if(head1 >= head2 && head1 >= head3) {
			if(i % t == 0) printf("%lld ", head1);
			h1++;
		} else if(head2 >= head1 && head2 >= head3) {
			if(i % t == 0) printf("%lld ", head2);
			h2++;
		} else {
			if(i % t == 0) printf("%lld ", head3);
			h3++;
		}
	}
}
```

