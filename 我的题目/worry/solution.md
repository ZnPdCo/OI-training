我们定义下文中 $\text{len}_x$ 表示 $x$ 在二进制中的位数。

---

我们讨论一个简化版的问题。在从 $0$ 开始标号的长度为 $2^w$ 的一维坐标轴上，第 $x$ 个点的力量为 $\varphi(x\operatorname{xor}k)$。求总力量。

异或操作的特殊性使我们可以利用它的很多性质，比如说对于一个给定的 $x\le2^w-1$，不定的 $y\le2^w-1$，$x\operatorname{xor}y$ 可以得出 $[0,2^w-1]$ 中的每一个数**恰好一次**。

所以答案显然为 $\sum_{i=0}^{2^w-1} \varphi(i)$。

---

我们将题目进阶。在从 $0$ 开始标号的长为 $2^w$，宽为 $2^u$ 的二维坐标系上，第 $(x,y)$ 个点的力量为 $\varphi(x\operatorname{xor}y\operatorname{xor}k)$。求总力量。

假设 $\text{len}_x\le\text{len}_y$。无论 $x$ 怎么变化，我们定住 $x$ 不动，它依旧和上面这一段是一样的。$x$ 有 $2^x$ 种取值，所以我们就可以根据上段的答案乘上 $2^x$ 即可。

---

考虑将 $n,m$ 分解为多个 $2^w$ 的和，我们将这些分开计算。

对于完好的圣遗物，我们在上面分析完了。对于拉几圣遗物，发现原操作实际上就是取模，我们只需要将函数分为 $\lfloor\frac{n}{p}\rfloor$ 段统计即可。

